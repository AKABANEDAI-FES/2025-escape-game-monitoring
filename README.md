# 「だるまさんが転んだ」判定システム

## 1. 概要

PCに接続されたWebカメラの映像を利用して遊ぶ、タイムアタック形式のWebアプリケーションです。プレイヤーは3分間の持ち時間内に、赤信号で停止し、緑信号で進むルールに従います。赤信号中に動くと持ち時間が減点されます。持ち時間が0になるまで、どれだけ長く耐えられるかに挑戦します。

## 2. 主な機能

- Webカメラによるリアルタイム映像表示
- 緑信号（動いてOK）と赤信号（停止）の自動切り替え
- 赤信号中の動体検知によるペナルティ（-5秒）
- 3分間のタイムアタックモード
- ゲームオーバーと再スタート機能
- レスポンシブデザインによる画面サイズへの最適化

## 3. 技術スタック

- **バックエンド**: Python, Flask, OpenCV
- **フロントエンド**: HTML, CSS, JavaScript

## 4. セットアップと実行方法

このプロジェクトをローカルPCで実行するための手順です。

### 前提条件

- [Python 3.8](https://www.python.org/downloads/) 以上
- [pip](https://pip.pypa.io/en/stable/installation/) (Pythonに付属)
- [Git](https://git-scm.com/downloads/)
- PCに接続されたWebカメラ

### 手順

1.  **リポジトリをクローン**

    ターミナルまたはコマンドプロンプトを開き、任意のディレクトリで以下のコマンドを実行して、プロジェクトをダウンロードします。

    ```bash
    git clone git@github.com:AKABANEDAI-FES/2025-escape-game-monitoring.git
    ```

2.  **プロジェクトディレクトリに移動**

    ```bash
    cd 2025-escape-game-monitoring
    ```

3.  **Python仮想環境の作成と有効化**

    プロジェクトの依存関係を管理するために、仮想環境を作成します。

    - **macOS / Linux の場合:**
      ```bash
      python3 -m venv .venv
      source .venv/bin/activate
      ```
    - **Windows の場合:**
      ```bash
      python -m venv .venv
      .\.venv\Scripts\activate
      ```

4.  **必要なライブラリをインストール**

    `requirements.txt` ファイルを使って、必要なPythonライブラリをインストールします。

    ```bash
    pip install -r requirements.txt
    ```

5.  **アプリケーションの起動**

    以下のコマンドでWebサーバーを起動します。

    ```bash
    python app.py
    ```

6.  **ブラウザでアクセス**

    Webブラウザを開き、以下のアドレスにアクセスしてください。

    [http://localhost:5000](http://localhost:5000)

    ゲーム画面が表示され、カメラへのアクセス許可を求められた場合は、許可してください。

### カメラ接続時のヒント

- Windowsの場合Ubuntuを使用しないでください
- `CAMERA_INDEX` 環境変数で利用するカメラ番号を変更できます（例: 外付けカメラが `1` の場合）。
- Windows でカメラが起動しない場合は、以下のようにバックエンドを指定してアプリを再起動してください。
  - コマンドプロンプト: `set CAMERA_BACKENDS=CAP_DSHOW`
  - PowerShell: `$env:CAMERA_BACKENDS = 'CAP_DSHOW'`
  - DirectShow が使用できない場合は `CAP_MSMF` に切り替えて試してください。
- Windows の「プライバシーとセキュリティ > カメラ」で、"デスクトップ アプリ" を含むカメラアクセスが許可されていること、他のアプリが使用中でないことを確認してください。

バックエンドを指定すると、アプリの起動時にコンソールへ選択されたバックエンドが表示されます。成功メッセージが表示されない場合は、別のバックエンドまたはカメラ番号を試してください。

## 5. 注意事項

- アプリケーションの実行には、PCにWebカメラが接続されている必要があります。
- 初回アクセス時に、ブラウザからカメラへのアクセス許可を求められる場合があります。許可しないと映像が表示されません。
- カメラが認識されない場合、黒い画面に「Camera not available」というメッセージが表示されます。カメラの接続やドライバを確認してください。
